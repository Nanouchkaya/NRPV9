<!-- BEGIN catrow -->
	<!-- BEGIN tablehead -->
		<div class="category">
                        <div class="cat-title">{catrow.tablehead.L_FORUM}</div>
                  	<div class="wrapper-list">
			  <ul class="forumrows">
	<!-- END tablehead -->                                                 

	<!-- BEGIN forumrow -->
				<li class="forumrow">
                                  <h{catrow.forumrow.LEVEL} class="forumrow-title">
					<a href="{catrow.forumrow.U_VIEWFORUM}">{catrow.forumrow.FORUM_NAME}</a>
				  </h{catrow.forumrow.LEVEL}>
                                                               
                                  <dl class="forumrow-content">                                   
                                    <dd class="forumrow-desc">{catrow.forumrow.FORUM_DESC}</dd>
                                    <dd class="forum-links">{catrow.forumrow.L_LINKS}{catrow.forumrow.LINKS}</dd>                                 
                                    <dd class="forumrow-stats">{catrow.forumrow.POSTS} messages dans {catrow.forumrow.TOPICS} sujets </dd>
                                    <dd class="forumrow-lastpost" title="{catrow.forumrow.L_FORUM_FOLDER_ALT}">{catrow.forumrow.LAST_POST}</dd>
                                  </dl>
				</li>
	<!-- END forumrow -->
	<!-- BEGIN tablefoot -->
			  </ul>
                  </div>
		</div>
	<!-- END tablefoot -->
<!-- END catrow -->

<script type="text/javascript">
 $("span[data-cat='NM']").parents("div.category").attr("id","cat_NM");
  $("span[data-cat='faille']").parents("div.category").attr("id","cat_faille");
  $("span[data-cat='general']").parents("div.category").attr("id","cat_general");
  $("span[data-level='one']").parents("li.forumrow").addClass("level_one");
  $("span[data-level='two']").parents("li.forumrow").addClass("level_two");
   $("span[data-level='three']").parents("li.forumrow").addClass("level_three");
  
  $("span[data-ong='general']").parents("li.forumrow").attr("id","general").addClass('visible onglets');
  $("span[data-ong='MM']").parents("li.forumrow").attr("id","ong-MM").addClass('forumNM');
  $("span[data-ong='chimeres']").parents("li.forumrow").attr("id","ong-chimeres").addClass('forumNM');
  $("span[data-ong='AdP']").parents("li.forumrow").attr("id","ong-AdP").addClass('forumNM');
  $("span[data-ong='xmen']").parents("li.forumrow").attr("id","ong-xmen").addClass('forumNM');
  $("span[data-ong='zombie']").parents("li.forumrow").attr("id","ong-zombie").addClass('forumNM');
  $("span[data-ong='AP']").parents("li.forumrow").attr("id","ong-AP").addClass('forumNM');
  
  document.getElementById('cat_NM').innerHTML = document.getElementById('cat_NM').innerHTML.replace('<li class="forumrow forumNM" id="ong-MM">','<div class="listLieuxNM onglets" id="nm-MM"><li class="forumrow forumNM" id="ong-MM">').replace('<li class="forumrow forumNM" id="ong-AP">','</div><div class="listLieuxNM onglets" id="nm-AP"><li class="forumrow forumNM" id="ong-AP">').replace('<li class="forumrow forumNM" id="ong-zombie">','</div><div class="listLieuxNM onglets" id="nm-zombie"><li class="forumrow forumNM" id="ong-zombie">').replace('<li class="forumrow forumNM" id="ong-AdP">','</div><div class="listLieuxNM onglets" id="nm-AdP"><li class="forumrow forumNM" id="ong-AdP">').replace('<li class="forumrow forumNM" id="ong-xmen">','</div><div class="listLieuxNM onglets" id="nm-xmen"><li class="forumrow forumNM" id="ong-xmen">').replace('<li class="forumrow forumNM" id="ong-chimeres">','</div><div class="listLieuxNM onglets" id="nm-chimeres"><li class="forumrow forumNM" id="ong-chimeres">').replace('</li></ul></div>','</li></div></ul>');
  
  
 function switchOnglet () {

  $('#cat_NM .forumrows').before('<nav class="onglets"><a href="#general" class="onglets-link">Général</a><a href="#nm-MM" class="onglets-link">Pico. Monde</a><a href="#nm-AP" class="onglets-link">Alpha Perdu</a><a href="#nm-zombie" class="onglets-link">Zombieland</a><a href="#nm-AdP" class="onglets-link">Aventures du passé</a><a href="#nm-xmen" class="onglets-link">X-men</a><a href="#nm-chimeres" class="onglets-link">Chimères</a></nav>');

  document.querySelectorAll('.onglets-link').forEach(link => {
    link.addEventListener("click", function(e) { 
      e.preventDefault();
      
      document.querySelectorAll('.onglets').forEach(onglet => {    
        if ( $(onglet).hasClass('visible') ) {
          $(onglet).removeClass('visible');
        }
      });
      
	var NM = $(e.target).attr('href');
      document.querySelector(NM).classList.add('visible');
    });
  });
};
switchOnglet();

//<![CDATA[
$(document).ready(function() {
	var btn_collapse = $('<div></div>', {
		class: 'btn-collapse'
	});

	var btn_collapse_show = $('<i></i>', {
		class: 'ion-android-add-circle hidden',
		'data-tooltip': '{L_EXPEND_CAT}'
	}).appendTo(btn_collapse);

	var btn_collapse_hide = $('<i></i>', {
		class: 'ion-android-remove-circle',
		'data-tooltip': '{L_HIDE_CAT}'
	}).appendTo(btn_collapse);

	var collapsed = [];

	if (readCookie('collapsed') != null && readCookie('collapsed') != '') {
		collapsed = readCookie('collapsed').split(',');
	}

	$(document).on('click', '.btn-collapse', function() {
		$(this).children('.ion-android-add-circle').toggleClass('hidden');
		$(this).children('.ion-android-remove-circle').toggleClass('hidden');
		$(this).parents('.forabg').toggleClass('hidden');

		if (readCookie('collapsed') != null && readCookie('collapsed') != '') {
			collapsed = readCookie('collapsed').split(',');
		}

		if (!$(this).parents('.forabg').hasClass('hidden')) {
			removeFromArray('' + $(this).parents('.forabg').data('cindex'), collapsed);

			createCookie('collapsed', collapsed);
		} else {
			collapsed.push('' + $(this).parents('.forabg').data('cindex'));

			createCookie('collapsed', collapsed);
		}
	});

	$('.forabg').each(function(i) {
		$(this).data('cindex', '' + i);

		$(btn_collapse)
			.clone()
			.attr('id', 'forabg' + i)
			.appendTo($(this).find('.header'));

		if ($.inArray('' + i, collapsed) > -1) {
			$(this).toggleClass('hidden');
			$('#forabg' + i).children('.ion-android-add-circle').toggleClass('hidden');
			$('#forabg' + i).children('.ion-android-remove-circle').toggleClass('hidden');
		}
	});
});

function removeFromArray(item, array) {
	var i = array.indexOf(item);

	if (i > -1) {
		array = array.splice(i, 1);
	}
}

function createCookie(name, value, days) {
	var expires;

	if (days) {
		var date = new Date();
		date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
		expires = "; expires=" + date.toGMTString();
	} else {
		expires = "";
	}
	document.cookie = encodeURIComponent(name) + "=" + encodeURIComponent(value) + expires + "; path=/";
}

function readCookie(name) {
	var nameEQ = encodeURIComponent(name) + "=";
	var ca = document.cookie.split(';');
	for (var i = 0; i < ca.length; i++) {
		var c = ca[i];
		while (c.charAt(0) === ' ') c = c.substring(1, c.length);
		if (c.indexOf(nameEQ) === 0) return decodeURIComponent(c.substring(nameEQ.length, c.length));
	}
	return null;
}
//]]>
</script>
